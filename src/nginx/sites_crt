NginxSitesCertInstall()
{
    local domain=$1

    if [ -e "/usr/local/nginx/conf/sites_crt/$domain.crt" ] && [ -d /usr/local/openresty/nginx/conf ] && [ ! -e "/usr/local/openresty/nginx/conf/sites_crt/$domain.crt" ]
    then
        mkdir -p /usr/local/openresty/nginx/conf/sites_crt
        ln "/usr/local/nginx/conf/sites_crt/$domain.crt" "/usr/local/openresty/nginx/conf/sites_crt/$domain.crt"
        ln "/usr/local/nginx/conf/sites_crt/$domain.key" "/usr/local/openresty/nginx/conf/sites_crt/$domain.key"
    elif [ -e "/usr/local/openresty/nginx/conf/sites_crt/$domain.crt" ] && [ -d /usr/local/nginx/conf ] && [ ! -e "/usr/local/nginx/conf/sites_crt/$domain.crt" ] 
    then
        mkdir -p /usr/local/nginx/conf/sites_crt
        ln "/usr/local/openresty/nginx/conf/sites_crt/$domain.crt" "/usr/local/nginx/conf/sites_crt/$domain.crt"
        ln "/usr/local/openresty/nginx/conf/sites_crt/$domain.key" "/usr/local/nginx/conf/sites_crt/$domain.key"
    fi

    if [ -e "$nginx_prefix/conf/sites_crt/$domain.crt" ] && [ -e "$nginx_prefix/conf/sites_crt/$domain.key" ]
    then
        echo
        inquirer list_input "检测到证书已存在, 是否重新安装证书" ny_options reinstall_crt_yn
        if [ "$reinstall_crt_yn" == "$i18n_no" ] 
        then
            return 0
        fi
    fi

    AcmeCheck

    Println "$info 安装 $domain 证书..."

    NginxDomainUpdateCrt "$domain" 1

    Println "$info $domain 证书安装成功\n"
}

NginxSitesCrtManage()
{
    if [ ! -d "$nginx_prefix"/conf/sites_crt ] 
    then
        Println "$error 请先安装 $nginx_name\n"
        return 1
    fi

    echo
    crt_options=( '查看证书' '安装本地证书' '安装域名证书' )
    inquirer list_input_index "选择操作" crt_options crt_options_index

    case $crt_options_index in
        0) ServiceBrowse "$nginx_prefix"/conf/sites_crt
        ;;
        1) 
            cd "$nginx_prefix"/conf/sites_crt
            openssl genrsa -out localhost.key 2048
            openssl req -subj "/C=US/ST=NULL/L=NULL/O=NULL/OU=NULL/CN=NULL/emailAddress=NULL@example.com" -new -key localhost.key -out localhost.csr
            openssl x509 -req -days 3650 -in localhost.csr -signkey localhost.key -out localhost.crt
            Println "$info 本地证书安装成功\n"
        ;;
        2) NginxConfigDomain
        ;;
    esac

    return 0
}
